name: Download_From_OK_RU_To_HuggingFace
on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Ù„ÛŒÙ†Ú©ÛŒ Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• (ÙˆÛ•Ú© ok.ru)'
        required: true
      file_name:
        description: 'Ù†Ø§ÙˆÛŒ ÙØ§ÛŒÙ„Û•Ú©Û• Ù„Û•Ù†Ø§Ùˆ Hugging Face'
        required: true
        default: 'video_okru.mp4'

jobs:
  upload_job:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ—ï¸ Setup Tools
        run: |
          sudo apt-get update -qq
          # Ø¯Ø§Ø¨Û•Ø²Ø§Ù†Ø¯Ù†ÛŒ ffmpeg Ø²Û†Ø± Ú¯Ø±Ù†Ú¯Û• Ø¨Û† ØªÛÚ©Û•ÚµÚ©Ø±Ø¯Ù†ÛŒ Ø¯Û•Ù†Ú¯ Ùˆ Ú•Û•Ù†Ú¯ Ø¦Û•Ú¯Û•Ø± Ø¬ÛŒØ§ Ø¨ÙˆÙˆÙ†
          sudo apt-get install -y ffmpeg -qq
          # Ù„ÛØ±Û•Ø¯Ø§ yt-dlp Ø¨Û•Ú©Ø§Ø±Ø¯ÛÙ†ÛŒÙ† Ù„Û• Ø¬ÛŒØ§ØªÛŒ aria2
          python -m pip install -U pip yt-dlp huggingface_hub

      - name: â¬‡ï¸ Extract and Download Video
        run: |
          # ÙÛ•Ø±Ù…Ø§Ù†ÛŒ yt-dlp Ø¨Û† Ø¯Û•Ø±Ù‡ÛÙ†Ø§Ù† Ùˆ Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ Ø¨Ø§Ø´ØªØ±ÛŒÙ† Ú©ÙˆØ§Ù„ÛØªÛŒ Ø¨Û• ÙÛ†Ø±Ù…Ø§ØªÛŒ mp4
          yt-dlp \
            -f "bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]/best" \
            --merge-output-format mp4 \
            -o "video.mp4" \
            "${{ github.event.inputs.video_url }}"

      - name: ğŸš€ Upload to Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python3 -c "
          import os
          from huggingface_hub import HfApi
          
          # ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ ØªÛ†Ú©Ù†
          token = os.getenv('HF_TOKEN')
          if not token:
              print('âŒ Error: HF_TOKEN is missing in GitHub Secrets!')
              exit(1)
              
          api = HfApi()
          repo_id = 'Sarkoakram/sarko761'
          file_name = '${{ github.event.inputs.file_name }}'
          
          # Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ• Ù„Û• Ø¨ÙˆÙˆÙ†ÛŒ ÙØ§ÛŒÙ„Û•Ú©Û• Ù¾ÛØ´ Ø¦Û•Ù¾ÚµÛ†Ø¯Ú©Ø±Ø¯Ù†
          if os.path.exists('video.mp4'):
              print(f'ğŸ“¤ Sending to Hugging Face: {file_name}...')
              api.upload_file(
                  path_or_fileobj='video.mp4',
                  path_in_repo=file_name,
                  repo_id=repo_id,
                  repo_type='dataset',
                  token=token
              )
              print('âœ… Done! Check your Hugging Face repo.')
          else:
              print('âŒ Error: video.mp4 not found. Download failed.')
              exit(1)
          "
